<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils/boundaryHelpers.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils/boundaryHelpers.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// src/utils/boundaryHelpers.js
// Boundary filtering utilities with support for multiple coordinate formats

/**
 * Get coordinates from property (supports multiple formats)
 */
export const getPropertyCoordinates = (property) => {
  // Try nested structure first (raw API response)
  const nestedLat = property.location?.address?.coordinate?.lat;
  const nestedLon = property.location?.address?.coordinate?.lon;
  
  if (nestedLat &amp;&amp; nestedLon) {
    return { lat: nestedLat, lon: nestedLon };
  }
  
  // Try flat structure (normalized properties)
  if (property.lat &amp;&amp; property.lon) {
    return { lat: property.lat, lon: property.lon };
  }
  
  return null;
};

/**
 * Check if a point is inside a circle
 */
export const isPointInCircle = (point, center, radius) => {
  const [lat1, lng1] = point;
  const [lat2, lng2] = center;
  
  const R = 6371000; // Earth's radius in meters
  const dLat = toRad(lat2 - lat1);
  const dLng = toRad(lng2 - lng1);
  
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
    Math.sin(dLng / 2) * Math.sin(dLng / 2);
  
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  const distance = R * c;
  
  return distance &lt;= radius;
};

/**
 * Check if a point is inside a polygon using ray casting algorithm
 */
export const isPointInPolygon = (point, polygon) => {
  const [lat, lng] = point;
  let inside = false;
  
  for (let i = 0, j = polygon.length - 1; i &lt; polygon.length; j = i++) {
    const [lat1, lng1] = polygon[i];
    const [lat2, lng2] = polygon[j];
    
    const intersect = ((lng1 > lng) !== (lng2 > lng)) &amp;&amp;
      (lat &lt; (lat2 - lat1) * (lng - lng1) / (lng2 - lng1) + lat1);
    
    if (intersect) inside = !inside;
  }
  
  return inside;
};

/**
 * Filter properties within boundary
 * Supports both nested and flat coordinate structures
 */
export const filterPropertiesInBoundary = (properties, boundary) => {
  if (!boundary || !properties || properties.length === 0) {
    return properties;
  }

  return properties.filter(property => {
    // Get coordinates using helper function
    const coords = getPropertyCoordinates(property);

    // Skip if no valid coordinates
    if (!coords) {
      return false;
    }

    const propertyPoint = [coords.lat, coords.lon];

    // Check based on boundary type
    if (boundary.type === 'circle') {
      return isPointInCircle(
        propertyPoint,
        boundary.center,
        boundary.radius
      );
    } else if (boundary.type === 'rectangle' || boundary.type === 'polygon') {
      return isPointInPolygon(propertyPoint, boundary.points);
    }

    return false;
  });
};

/**
 * Get count of properties within boundary
 */
export const getPropertiesCountInBoundary = (properties, boundary) => {
  const filtered = filterPropertiesInBoundary(properties, boundary);
  return filtered.length;
};

/**
 * Convert degrees to radians
 */
const toRad = (degrees) => {
  return degrees * (Math.PI / 180);
};

/**
 * Get the center point of a polygon
 */
export const getPolygonCenter = (polygon) => {
  if (!polygon || polygon.length === 0) return null;
  
  let latSum = 0;
  let lngSum = 0;
  
  polygon.forEach(([lat, lng]) => {
    latSum += lat;
    lngSum += lng;
  });
  
  return [
    latSum / polygon.length,
    lngSum / polygon.length
  ];
};

/**
 * Calculate approximate area of polygon in square meters
 */
export const calculatePolygonArea = (polygon) => {
  if (!polygon || polygon.length &lt; 3) return 0;
  
  const R = 6371000; // Earth's radius in meters
  let area = 0;
  
  for (let i = 0; i &lt; polygon.length; i++) {
    const [lat1, lng1] = polygon[i];
    const [lat2, lng2] = polygon[(i + 1) % polygon.length];
    
    area += toRad(lng2 - lng1) * 
            (2 + Math.sin(toRad(lat1)) + Math.sin(toRad(lat2)));
  }
  
  area = Math.abs(area * R * R / 2);
  return area;
};

/**
 * Format area for display
 */
export const formatArea = (areaInMeters) => {
  if (areaInMeters &lt; 1000000) {
    return `${(areaInMeters / 1000).toFixed(2)} km²`;
  }
  return `${areaInMeters.toFixed(0)} m²`;
};

/**
 * Format distance for display
 */
export const formatDistance = (distanceInMeters) => {
  if (distanceInMeters &lt; 1000) {
    return `${distanceInMeters.toFixed(0)} m`;
  }
  return `${(distanceInMeters / 1000).toFixed(2)} km`;
};

/**
 * Calculate distance between two points in meters
 */
export const calculateDistance = (point1, point2) => {
  const [lat1, lng1] = point1;
  const [lat2, lng2] = point2;
  
  const R = 6371000; // Earth's radius in meters
  const dLat = toRad(lat2 - lat1);
  const dLng = toRad(lng2 - lng1);
  
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
    Math.sin(dLng / 2) * Math.sin(dLng / 2);
  
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
};

export default {
  getPropertyCoordinates,
  isPointInCircle,
  isPointInPolygon,
  filterPropertiesInBoundary,
  getPropertiesCountInBoundary,
  getPolygonCenter,
  calculatePolygonArea,
  calculateDistance,
  formatArea,
  formatDistance,
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-components_analysis_BuyHoldProjections.html">components/analysis/BuyHoldProjections</a></li><li><a href="module-components_analysis_PurchaseWorksheet.html">components/analysis/PurchaseWorksheet</a></li><li><a href="module-components_features_ExpandedPropertyView.html">components/features/ExpandedPropertyView</a></li><li><a href="module-components_features_PropertiesGrid.html">components/features/PropertiesGrid</a></li><li><a href="module-components_features_PropertyCard.html">components/features/PropertyCard</a></li><li><a href="module-components_features_PropertyMap.html">components/features/PropertyMap</a></li><li><a href="module-config_firebase.html">config/firebase</a></li><li><a href="module-contexts_AuthContext.html">contexts/AuthContext</a></li><li><a href="module-hooks_useSavedProperties.html">hooks/useSavedProperties</a></li><li><a href="module-pages_Properties.html">pages/Properties</a></li><li><a href="module-pages_PropertyAnalysisPage.html">pages/PropertyAnalysisPage</a></li><li><a href="module-services_database.html">services/database</a></li><li><a href="module-services_realtyAPI.html">services/realtyAPI</a></li><li><a href="module-services_rentCastApi.html">services/rentCastApi</a></li></ul><h3>Classes</h3><ul><li><a href="BuyRentHoldCalculator.html">BuyRentHoldCalculator</a></li><li><a href="RentalPropertyCalculator.html">RentalPropertyCalculator</a></li></ul><h3>Global</h3><ul><li><a href="global.html#CurrencyInput">CurrencyInput</a></li><li><a href="global.html#DEFAULTS">DEFAULTS</a></li><li><a href="global.html#DEFAULT_SCORING_CONFIG">DEFAULT_SCORING_CONFIG</a></li><li><a href="global.html#Dashboard">Dashboard</a></li><li><a href="global.html#InlineInput">InlineInput</a></li><li><a href="global.html#NumberInput">NumberInput</a></li><li><a href="global.html#PercentInput">PercentInput</a></li><li><a href="global.html#Profile">Profile</a></li><li><a href="global.html#SCORING_PRESETS">SCORING_PRESETS</a></li><li><a href="global.html#applyScoringPreset">applyScoringPreset</a></li><li><a href="global.html#calculateDistance">calculateDistance</a></li><li><a href="global.html#calculateDynamicScore">calculateDynamicScore</a></li><li><a href="global.html#calculateInvestmentScore">calculateInvestmentScore</a></li><li><a href="global.html#calculateMonthlyPayment">calculateMonthlyPayment</a></li><li><a href="global.html#calculatePolygonArea">calculatePolygonArea</a></li><li><a href="global.html#calculatePrincipalPaidYear1">calculatePrincipalPaidYear1</a></li><li><a href="global.html#calculateProfileScore">calculateProfileScore</a></li><li><a href="global.html#calculateQuickScore">calculateQuickScore</a></li><li><a href="global.html#calculateVerifiedScore">calculateVerifiedScore</a></li><li><a href="global.html#clearCache">clearCache</a></li><li><a href="global.html#detectMultiFamily">detectMultiFamily</a></li><li><a href="global.html#detectMultiFamilyFromType">detectMultiFamilyFromType</a></li><li><a href="global.html#estimateRent">estimateRent</a></li><li><a href="global.html#estimateUnitsFromProperty">estimateUnitsFromProperty</a></li><li><a href="global.html#filterPropertiesInBoundary">filterPropertiesInBoundary</a></li><li><a href="global.html#formatArea">formatArea</a></li><li><a href="global.html#formatDistance">formatDistance</a></li><li><a href="global.html#getAvailableMetrics">getAvailableMetrics</a></li><li><a href="global.html#getCacheStats">getCacheStats</a></li><li><a href="global.html#getExpenseDefaults">getExpenseDefaults</a></li><li><a href="global.html#getFinancingDefaults">getFinancingDefaults</a></li><li><a href="global.html#getInvestmentTargets">getInvestmentTargets</a></li><li><a href="global.html#getInvestmentThresholds">getInvestmentThresholds</a></li><li><a href="global.html#getInvestorProfile">getInvestorProfile</a></li><li><a href="global.html#getPolygonCenter">getPolygonCenter</a></li><li><a href="global.html#getPreferredLocation">getPreferredLocation</a></li><li><a href="global.html#getPropertiesCountInBoundary">getPropertiesCountInBoundary</a></li><li><a href="global.html#getPropertyCoordinates">getPropertyCoordinates</a></li><li><a href="global.html#getPropertyDataOnHover">getPropertyDataOnHover</a></li><li><a href="global.html#getPropertyDetails">getPropertyDetails</a></li><li><a href="global.html#getRentEstimate">getRentEstimate</a></li><li><a href="global.html#getScoringPresets">getScoringPresets</a></li><li><a href="global.html#getScoringWeights">getScoringWeights</a></li><li><a href="global.html#hasPreferredLocation">hasPreferredLocation</a></li><li><a href="global.html#isPointInCircle">isPointInCircle</a></li><li><a href="global.html#isPointInPolygon">isPointInPolygon</a></li><li><a href="global.html#mapPropertyType">mapPropertyType</a></li><li><a href="global.html#meetsInvestmentCriteria">meetsInvestmentCriteria</a></li><li><a href="global.html#mergeScoringConfig">mergeScoringConfig</a></li><li><a href="global.html#router">router</a></li><li><a href="global.html#saveInvestorProfile">saveInvestorProfile</a></li><li><a href="global.html#toRad">toRad</a></li><li><a href="global.html#validateProfile">validateProfile</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Mon Dec 22 2025 22:17:13 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
